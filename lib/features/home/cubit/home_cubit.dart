import 'package:bloc/bloc.dart';
import 'package:flutter/src/widgets/framework.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:meta/meta.dart';
import 'package:googleapis/calendar/v3.dart' as calendar;
import 'package:googleapis_auth/auth_io.dart';

part 'home_state.dart';

class HomeCubit extends Cubit<HomeState> {

  HomeCubit() : super(HomeInitial());

  List<calendar.Event> calendarEvents = [];
  Future<void> _fetchEvents() async{
    emit(CalendarEventsLoading());
    final client = await clientViaUserConsent(ClientId('209168818420-hljiafsffidc4v0an8b73n0kub5bh3r7.apps.googleusercontent.com'),
        [calendar.CalendarApi.calendarScope], (uri) {
          print(uri);
        });

    final calenderApi = calendar.CalendarApi(client);

    final events = await calenderApi.events.list('primary');

    calendarEvents = events.items ?? List.empty();
    emit(CalendarEventsReady());
  }



  fetchCalenderEvents() => _fetchEvents();

  static HomeCubit get(BuildContext context) => BlocProvider.of(context);

}
