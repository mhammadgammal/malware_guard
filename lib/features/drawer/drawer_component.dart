import 'package:firebase_auth/firebase_auth.dart';
import 'package:malware_guard/core/router/app_navigator.dart';
import 'package:malware_guard/core/router/router_helper.dart';
import 'package:malware_guard/core/theme/app_text_style.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';

import '../../core/theme/app_color.dart';
import 'cubit/navigation_cubit.dart';

class NavigationDrawerComponent extends StatefulWidget {
  const NavigationDrawerComponent({super.key});

  @override
  State<NavigationDrawerComponent> createState() =>
      _NavigationDrawerComponentState();
}

class _NavigationDrawerComponentState extends State<NavigationDrawerComponent> {
  @override
  Widget build(BuildContext context) {
    return BlocBuilder<NavigationDrawerCubit, int>(
      builder: (builderContext, state) => SizedBox(
        width: 304.0,
        height: 993.0,
        child: Drawer(
          backgroundColor: const Color.fromRGBO(30, 29, 29, 1.0),
          child: Padding(
            padding: const EdgeInsetsDirectional.only(top: 40.0),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Expanded(
                  child: ListView.separated(
                      padding: EdgeInsets.zero,
                      itemBuilder: (context, index) => ListTile(
                            selected: state == index,
                            selectedTileColor: Colors.black87,
                            selectedColor: Colors.white,
                            leading: NavigationDrawerCubit.get(builderContext)
                                .mainScreens[index]
                                .icon,
                            title: Text(
                              NavigationDrawerCubit.get(builderContext)
                                  .mainScreens[index]
                                  .title,
                              style: AppTextStyle.font17White,
                            ),
                            onTap: () {
                              // Navigator.pop(context);
                              if (state != index) {
                                NavigationDrawerCubit.get(builderContext)
                                    .onNavigationTileTapped(index);
                                AppNavigator.navigateTo(
                                    context,
                                    NavigationDrawerCubit.get(builderContext)
                                        .mainScreens[index]
                                        .dist);
                              }
                            },
                          ),
                      separatorBuilder: (_, __) => const SizedBox(
                            height: 10.0,
                          ),
                      itemCount: NavigationDrawerCubit.get(builderContext)
                          .mainScreens
                          .length),
                ),
                const Divider(
                  height: 10.0,
                  indent: 10.0,
                  endIndent: 10.0,
                ),
                const Padding(
                  padding:
                      EdgeInsetsDirectional.only(start: 10.0, bottom: 10.0),
                  child: Text(
                    'How to Use',
                    style: TextStyle(
                        color: Colors.white,
                        fontSize: 17.0,
                        fontWeight: FontWeight.w400),
                  ),
                ),
                Expanded(
                    child: ListView.builder(
                  itemCount: NavigationDrawerCubit.get(builderContext)
                      .howToUseScreens
                      .length,
                  itemBuilder: (context, index) => ListTile(
                    selected: state ==
                        (NavigationDrawerCubit.get(builderContext)
                                .mainScreens
                                .length +
                            index),
                    selectedTileColor: Colors.black87,
                    selectedColor: Colors.white,
                    leading: NavigationDrawerCubit.get(builderContext)
                        .howToUseScreens[index]
                        .icon,
                    title: Text(
                      NavigationDrawerCubit.get(builderContext)
                          .howToUseScreens[index]
                          .title,
                      style: AppTextStyle.font17White,
                    ),
                    onTap: () {
                      // Navigator.pop(context);
                      NavigationDrawerCubit.get(builderContext)
                          .onNavigationTileTapped(index +
                              NavigationDrawerCubit.get(builderContext)
                                  .mainScreens
                                  .length);
                      AppNavigator.navigateTo(
                          context,
                          NavigationDrawerCubit.get(context)
                              .howToUseScreens[index]
                              .dist);
                    },
                  ),
                )),
                Container(
                  padding: const EdgeInsetsDirectional.all(5.0),
                  margin: const EdgeInsetsDirectional.only(
                    start: 10.0,
                    end: 10.0,
                  ),
                  decoration: BoxDecoration(
                    color: AppColor.primaryColor,
                    borderRadius: BorderRadius.circular(50.0),
                  ),
                  child: ListTile(
                    leading: CircleAvatar(
                      backgroundColor: Colors.white,
                      radius: 20.0,
                      child: NavigationDrawerCubit.get(builderContext)
                                  .user
                                  .photoUrl ==
                              null
                          ? const Icon(
                              Icons.person_2_outlined,
                              color: Colors.black,
                            )
                          : Image.network(
                            NavigationDrawerCubit.get(builderContext)
                                .user
                                .photoUrl!,
                          ),
                    ),
                    title: Text(
                      NavigationDrawerCubit.get(builderContext)
                          .user
                          .displayName,
                      style: AppTextStyle.font20White,
                    ),
                    subtitle: Text(
                      NavigationDrawerCubit.get(builderContext).user.email,
                      style: const TextStyle(
                        color: Colors.white,
                        decoration: TextDecoration.underline,
                        decorationColor: Colors.white,
                        decorationStyle: TextDecorationStyle.solid,
                        decorationThickness: 1.5,
                      ),
                    ),
                  ),
                ),
                const SizedBox(
                  height: 20.0,
                ),
                const Divider(
                  height: 10.0,
                  indent: 20.0,
                  endIndent: 20.0,
                ),
                MaterialButton(
                    onPressed: () {
                      _logout();
                    },
                    padding: const EdgeInsetsDirectional.all(30.0),
                    child: const Row(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        Icon(
                          Icons.logout_outlined,
                          color: Colors.white,
                        ),
                        SizedBox(
                          width: 10.0,
                        ),
                        Text(
                          'Log Out',
                          style: AppTextStyle.font17White,
                        ),
                      ],
                    )),
              ],
            ),
          ),
        ),
      ),
    );
  }

  void _logout() async {
    await FirebaseAuth.instance.signOut();
    setState(() {
      Navigator.pushNamedAndRemoveUntil(
          context, RouterHelper.boarding, ModalRoute.withName('/'));
    });
  }
}
