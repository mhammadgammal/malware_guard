// ignore_for_file: avoid_print

import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:malware_guard/features/history/data/history_model.dart';
import 'package:malware_guard/injection.dart';
import 'package:meta/meta.dart';

import '../../../core/user_model.dart';

part 'history_state.dart';

class HistoryCubit extends Cubit<HistoryState> {
  HistoryCubit() : super(HistoryInitial());

  static HistoryCubit get(context) => BlocProvider.of(context);
  List<HistoryModel> history = [];

  void fetchHistory() async {
    emit(HistoryDataLoadingState());
    print('fetchHistory');
    var db = FirebaseFirestore.instance;
    var docs =
        await db.collection('users/${sl<UserModel>().email}/history').get();
    history = List.generate(docs.docs.length,
        (index) => HistoryModel.fromJson(docs.docs[index].data()));
    print(
        'docs: ${List.generate(docs.docs.length, (index) => docs.docs[index].data())}');
    print('history: $history');
    emit(HistoryLoadedState());
  }
}
